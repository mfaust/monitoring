---
# project_name: monitoring
version: '2.0'
services:
  database:
    image: bodsch/docker-mysql:latest
    container_name: database
    hostname: database
    env_file:
      - env/database.env
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./data:/srv

  nginx:
    image: bodsch/docker-nginx:latest
    container_name: nginx
    hostname: nginx
    ports:
      - 80:80
    depends_on:
      - grafana
      - icingaweb2
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./share/nginx/var/www:/var/www:ro
      - ./share/nginx/etc/nginx/sites-enabled:/etc/nginx/sites-enabled:ro
      - ./share/nginx/etc/nginx/nginx.conf:/etc/nginx/nginx.conf:ro
      - ./share/nginx/etc/nginx/modules.d/00-restrictions.conf:/etc/nginx/modules.d/00-restrictions.conf:ro
      - ./share/nginx/etc/nginx/modules.d/01-proxy-grafana.conf:/etc/nginx/modules.d/01-proxy-grafana.conf:ro
      - ./share/nginx/etc/nginx/modules.d/01-proxy-icingaweb2.conf:/etc/nginx/modules.d/01-proxy-icingaweb2.conf:ro

  graphite:
    image: bodsch/docker-graphite:latest
    container_name: graphite
    hostname: graphite
    env_file:
      - env/database.env
      - env/graphite.env
    depends_on:
      - database
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./data:/srv

  grafana:
    image: bodsch/docker-grafana:latest
    container_name: grafana
    hostname: grafana
    env_file:
      - env/database.env
      - env/grafana.env
    depends_on:
      - database
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./data:/srv

  icinga2:
    image: bodsch/docker-icinga2:latest
    container_name: icinga2
    hostname: icinga2
    env_file:
      - env/database.env
      - env/icinga2.env
    depends_on:
      - database
    ports:
      - 5665:5665
      - 6666:6666
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./data:/srv
      - ./share/monitoring:/var/cache/monitoring
      - ./share/icinga2/usr/local/monitoring:/usr/local/monitoring
      - ./share/icinga2/etc/icinga2/objects:/etc/icinga2/objects
    links:
      - database:database

  icingaweb2:
    image: bodsch/docker-icingaweb2:latest
    container_name: icingaweb2
    hostname: icingaweb2
    env_file:
      - env/database.env
      - env/icinga2.env
      - env/icingaweb2.env
    depends_on:
      - database
      - icinga2
    volumes:
      - /etc/localtime:/etc/localtime:ro
      - ./data:/srv
      - ./share/icingaweb2:/usr/local/share
    volumes_from:
      - icinga2
    links:
      - database:database
      - icinga2:icinga2

